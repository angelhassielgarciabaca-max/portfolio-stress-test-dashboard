{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "c3ae8166-db7e-428a-b657-7d203ef6b5ba",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n",
      "A module that was compiled using NumPy 1.x cannot be run in\n",
      "NumPy 2.4.1 as it may crash. To support both 1.x and 2.x\n",
      "versions of NumPy, modules must be compiled with NumPy 2.0.\n",
      "Some module may need to rebuild instead e.g. with 'pybind11>=2.12'.\n",
      "\n",
      "If you are a user of the module, the easiest solution will be to\n",
      "downgrade to 'numpy<2' or try to upgrade the affected module.\n",
      "We expect that some modules will need time to support NumPy 2.\n",
      "\n",
      "Traceback (most recent call last):  File \"/home/hassiel/anaconda3/lib/python3.11/runpy.py\", line 198, in _run_module_as_main\n",
      "    return _run_code(code, main_globals, None,\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/runpy.py\", line 88, in _run_code\n",
      "    exec(code, run_globals)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel_launcher.py\", line 18, in <module>\n",
      "    app.launch_new_instance()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/traitlets/config/application.py\", line 1075, in launch_instance\n",
      "    app.start()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelapp.py\", line 739, in start\n",
      "    self.io_loop.start()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/tornado/platform/asyncio.py\", line 211, in start\n",
      "    self.asyncio_loop.run_forever()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/base_events.py\", line 607, in run_forever\n",
      "    self._run_once()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/base_events.py\", line 1922, in _run_once\n",
      "    handle._run()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/events.py\", line 80, in _run\n",
      "    self._context.run(self._callback, *self._args)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 519, in dispatch_queue\n",
      "    await self.process_one()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 508, in process_one\n",
      "    await dispatch(*args)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 400, in dispatch_shell\n",
      "    await result\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/ipkernel.py\", line 368, in execute_request\n",
      "    await super().execute_request(stream, ident, parent)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 767, in execute_request\n",
      "    reply_content = await reply_content\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/ipkernel.py\", line 455, in do_execute\n",
      "    res = shell.run_cell(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/zmqshell.py\", line 577, in run_cell\n",
      "    return super().run_cell(*args, **kwargs)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3075, in run_cell\n",
      "    result = self._run_cell(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3130, in _run_cell\n",
      "    result = runner(coro)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/async_helpers.py\", line 128, in _pseudo_sync_runner\n",
      "    coro.send(None)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3334, in run_cell_async\n",
      "    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3517, in run_ast_nodes\n",
      "    if await self.run_code(code, result, async_=asy):\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3577, in run_code\n",
      "    exec(code_obj, self.user_global_ns, self.user_ns)\n",
      "  File \"/tmp/ipykernel_15074/4250095859.py\", line 2, in <module>\n",
      "    import yfinance as yf\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/yfinance/__init__.py\", line 23, in <module>\n",
      "    from .search import Search\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/yfinance/search.py\", line 25, in <module>\n",
      "    from . import utils\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/yfinance/utils.py\", line 36, in <module>\n",
      "    import pandas as _pd\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pandas/__init__.py\", line 26, in <module>\n",
      "    from pandas.compat import (\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pandas/compat/__init__.py\", line 29, in <module>\n",
      "    from pandas.compat.pyarrow import (\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pandas/compat/pyarrow.py\", line 8, in <module>\n",
      "    import pyarrow as pa\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pyarrow/__init__.py\", line 65, in <module>\n",
      "    import pyarrow.lib as _lib\n"
     ]
    },
    {
     "ename": "AttributeError",
     "evalue": "_ARRAY_API not found",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mAttributeError\u001b[0m                            Traceback (most recent call last)",
      "\u001b[0;31mAttributeError\u001b[0m: _ARRAY_API not found"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "\n",
      "A module that was compiled using NumPy 1.x cannot be run in\n",
      "NumPy 2.4.1 as it may crash. To support both 1.x and 2.x\n",
      "versions of NumPy, modules must be compiled with NumPy 2.0.\n",
      "Some module may need to rebuild instead e.g. with 'pybind11>=2.12'.\n",
      "\n",
      "If you are a user of the module, the easiest solution will be to\n",
      "downgrade to 'numpy<2' or try to upgrade the affected module.\n",
      "We expect that some modules will need time to support NumPy 2.\n",
      "\n",
      "Traceback (most recent call last):  File \"/home/hassiel/anaconda3/lib/python3.11/runpy.py\", line 198, in _run_module_as_main\n",
      "    return _run_code(code, main_globals, None,\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/runpy.py\", line 88, in _run_code\n",
      "    exec(code, run_globals)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel_launcher.py\", line 18, in <module>\n",
      "    app.launch_new_instance()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/traitlets/config/application.py\", line 1075, in launch_instance\n",
      "    app.start()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelapp.py\", line 739, in start\n",
      "    self.io_loop.start()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/tornado/platform/asyncio.py\", line 211, in start\n",
      "    self.asyncio_loop.run_forever()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/base_events.py\", line 607, in run_forever\n",
      "    self._run_once()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/base_events.py\", line 1922, in _run_once\n",
      "    handle._run()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/events.py\", line 80, in _run\n",
      "    self._context.run(self._callback, *self._args)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 519, in dispatch_queue\n",
      "    await self.process_one()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 508, in process_one\n",
      "    await dispatch(*args)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 400, in dispatch_shell\n",
      "    await result\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/ipkernel.py\", line 368, in execute_request\n",
      "    await super().execute_request(stream, ident, parent)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 767, in execute_request\n",
      "    reply_content = await reply_content\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/ipkernel.py\", line 455, in do_execute\n",
      "    res = shell.run_cell(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/zmqshell.py\", line 577, in run_cell\n",
      "    return super().run_cell(*args, **kwargs)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3075, in run_cell\n",
      "    result = self._run_cell(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3130, in _run_cell\n",
      "    result = runner(coro)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/async_helpers.py\", line 128, in _pseudo_sync_runner\n",
      "    coro.send(None)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3334, in run_cell_async\n",
      "    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3517, in run_ast_nodes\n",
      "    if await self.run_code(code, result, async_=asy):\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3577, in run_code\n",
      "    exec(code_obj, self.user_global_ns, self.user_ns)\n",
      "  File \"/tmp/ipykernel_15074/4250095859.py\", line 2, in <module>\n",
      "    import yfinance as yf\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/yfinance/__init__.py\", line 23, in <module>\n",
      "    from .search import Search\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/yfinance/search.py\", line 25, in <module>\n",
      "    from . import utils\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/yfinance/utils.py\", line 36, in <module>\n",
      "    import pandas as _pd\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pandas/__init__.py\", line 49, in <module>\n",
      "    from pandas.core.api import (\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pandas/core/api.py\", line 9, in <module>\n",
      "    from pandas.core.dtypes.dtypes import (\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pandas/core/dtypes/dtypes.py\", line 24, in <module>\n",
      "    from pandas._libs import (\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pyarrow/__init__.py\", line 65, in <module>\n",
      "    import pyarrow.lib as _lib\n"
     ]
    },
    {
     "ename": "AttributeError",
     "evalue": "_ARRAY_API not found",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mAttributeError\u001b[0m                            Traceback (most recent call last)",
      "\u001b[0;31mAttributeError\u001b[0m: _ARRAY_API not found"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2026-01-18 19:23:55.421 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.422 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.539 \n",
      "  \u001b[33m\u001b[1mWarning:\u001b[0m to view this Streamlit app on a browser, run it with the following\n",
      "  command:\n",
      "\n",
      "    streamlit run /home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel_launcher.py [ARGUMENTS]\n",
      "2026-01-18 19:23:55.541 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.541 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.542 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.543 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.544 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.545 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.546 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.547 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.549 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.550 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.551 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.552 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.553 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.554 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.554 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.555 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.555 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.557 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.558 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.559 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.559 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.560 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.561 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.561 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.562 Session state does not function when running a script without `streamlit run`\n",
      "2026-01-18 19:23:55.562 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.563 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.563 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.564 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.565 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.565 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.566 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.567 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.568 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.568 No runtime found, using MemoryCacheStorageManager\n",
      "2026-01-18 19:23:55.570 No runtime found, using MemoryCacheStorageManager\n",
      "2026-01-18 19:23:55.571 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.572 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.575 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:55.576 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "/tmp/ipykernel_15074/4250095859.py:37: FutureWarning: YF.download() has changed argument auto_adjust default to True\n",
      "  df = yf.download(tickers, period=\"1y\")['Close']\n",
      "[                       0%                       ]2026-01-18 19:23:56.077 Thread 'Thread-5': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.079 Thread 'Thread-5': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.080 Thread 'Thread-5': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "[*********************100%***********************]  3 of 3 completed\n",
      "2026-01-18 19:23:56.311 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.312 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.314 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.424 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.424 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.425 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.425 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.426 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.427 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.427 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.428 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.429 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.431 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.432 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.432 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.433 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.434 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.435 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2026-01-18 19:23:56.436 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "\n",
      "A module that was compiled using NumPy 1.x cannot be run in\n",
      "NumPy 2.4.1 as it may crash. To support both 1.x and 2.x\n",
      "versions of NumPy, modules must be compiled with NumPy 2.0.\n",
      "Some module may need to rebuild instead e.g. with 'pybind11>=2.12'.\n",
      "\n",
      "If you are a user of the module, the easiest solution will be to\n",
      "downgrade to 'numpy<2' or try to upgrade the affected module.\n",
      "We expect that some modules will need time to support NumPy 2.\n",
      "\n",
      "Traceback (most recent call last):  File \"/home/hassiel/anaconda3/lib/python3.11/runpy.py\", line 198, in _run_module_as_main\n",
      "    return _run_code(code, main_globals, None,\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/runpy.py\", line 88, in _run_code\n",
      "    exec(code, run_globals)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel_launcher.py\", line 18, in <module>\n",
      "    app.launch_new_instance()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/traitlets/config/application.py\", line 1075, in launch_instance\n",
      "    app.start()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelapp.py\", line 739, in start\n",
      "    self.io_loop.start()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/tornado/platform/asyncio.py\", line 211, in start\n",
      "    self.asyncio_loop.run_forever()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/base_events.py\", line 607, in run_forever\n",
      "    self._run_once()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/base_events.py\", line 1922, in _run_once\n",
      "    handle._run()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/asyncio/events.py\", line 80, in _run\n",
      "    self._context.run(self._callback, *self._args)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 519, in dispatch_queue\n",
      "    await self.process_one()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 508, in process_one\n",
      "    await dispatch(*args)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 400, in dispatch_shell\n",
      "    await result\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/ipkernel.py\", line 368, in execute_request\n",
      "    await super().execute_request(stream, ident, parent)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/kernelbase.py\", line 767, in execute_request\n",
      "    reply_content = await reply_content\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/ipkernel.py\", line 455, in do_execute\n",
      "    res = shell.run_cell(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/ipykernel/zmqshell.py\", line 577, in run_cell\n",
      "    return super().run_cell(*args, **kwargs)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3075, in run_cell\n",
      "    result = self._run_cell(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3130, in _run_cell\n",
      "    result = runner(coro)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/async_helpers.py\", line 128, in _pseudo_sync_runner\n",
      "    coro.send(None)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3334, in run_cell_async\n",
      "    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3517, in run_ast_nodes\n",
      "    if await self.run_code(code, result, async_=asy):\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/IPython/core/interactiveshell.py\", line 3577, in run_code\n",
      "    exec(code_obj, self.user_global_ns, self.user_ns)\n",
      "  File \"/tmp/ipykernel_15074/4250095859.py\", line 90, in <module>\n",
      "    st.altair_chart(chart, use_container_width=True)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/streamlit/runtime/metrics_util.py\", line 447, in wrapped_func\n",
      "    result = non_optional_func(*args, **kwargs)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py\", line 1903, in altair_chart\n",
      "    return self._altair_chart(\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py\", line 2171, in _altair_chart\n",
      "    vega_lite_spec = _convert_altair_to_vega_lite_spec(altair_chart)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py\", line 419, in _convert_altair_to_vega_lite_spec\n",
      "    chart_dict = altair_chart.to_dict()\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/altair/vegalite/v5/api.py\", line 4033, in to_dict\n",
      "    return super().to_dict(**kwds)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/altair/vegalite/v5/api.py\", line 1998, in to_dict\n",
      "    copy.data = _prepare_data(data, context)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/altair/vegalite/v5/api.py\", line 283, in _prepare_data\n",
      "    data = func(nw.to_native(data, pass_through=True))\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py\", line 2375, in _to_arrow_dataset\n",
      "    data_bytes = dataframe_util.convert_anything_to_arrow_bytes(data)\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/streamlit/dataframe_util.py\", line 899, in convert_anything_to_arrow_bytes\n",
      "    import pyarrow as pa\n",
      "  File \"/home/hassiel/anaconda3/lib/python3.11/site-packages/pyarrow/__init__.py\", line 65, in <module>\n",
      "    import pyarrow.lib as _lib\n"
     ]
    },
    {
     "ename": "AttributeError",
     "evalue": "_ARRAY_API not found",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mAttributeError\u001b[0m                            Traceback (most recent call last)",
      "\u001b[0;31mAttributeError\u001b[0m: _ARRAY_API not found"
     ]
    },
    {
     "ename": "ImportError",
     "evalue": "numpy.core.multiarray failed to import",
     "output_type": "error",
     "traceback": [
      "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[0;31mImportError\u001b[0m                               Traceback (most recent call last)",
      "Cell \u001b[0;32mIn[1], line 90\u001b[0m\n\u001b[1;32m     83\u001b[0m df_paths \u001b[38;5;241m=\u001b[39m pd\u001b[38;5;241m.\u001b[39mDataFrame(portafolio_paths[:, :\u001b[38;5;241m100\u001b[39m])\u001b[38;5;241m.\u001b[39mreset_index()\u001b[38;5;241m.\u001b[39mmelt(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mindex\u001b[39m\u001b[38;5;124m'\u001b[39m, var_name\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mSimulación\u001b[39m\u001b[38;5;124m'\u001b[39m, value_name\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mPrecio\u001b[39m\u001b[38;5;124m'\u001b[39m)\n\u001b[1;32m     84\u001b[0m chart \u001b[38;5;241m=\u001b[39m alt\u001b[38;5;241m.\u001b[39mChart(df_paths)\u001b[38;5;241m.\u001b[39mmark_line(opacity\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m0.3\u001b[39m, strokeWidth\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1\u001b[39m)\u001b[38;5;241m.\u001b[39mencode(\n\u001b[1;32m     85\u001b[0m     x\u001b[38;5;241m=\u001b[39malt\u001b[38;5;241m.\u001b[39mX(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mindex:Q\u001b[39m\u001b[38;5;124m'\u001b[39m, title\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mDías\u001b[39m\u001b[38;5;124m\"\u001b[39m),\n\u001b[1;32m     86\u001b[0m     y\u001b[38;5;241m=\u001b[39malt\u001b[38;5;241m.\u001b[39mY(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mPrecio:Q\u001b[39m\u001b[38;5;124m'\u001b[39m, title\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mValor Portafolio ($)\u001b[39m\u001b[38;5;124m\"\u001b[39m, scale\u001b[38;5;241m=\u001b[39malt\u001b[38;5;241m.\u001b[39mScale(zero\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mFalse\u001b[39;00m)),\n\u001b[1;32m     87\u001b[0m     detail\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mSimulación\u001b[39m\u001b[38;5;124m'\u001b[39m\n\u001b[1;32m     88\u001b[0m )\u001b[38;5;241m.\u001b[39mproperties(height\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m400\u001b[39m)\n\u001b[0;32m---> 90\u001b[0m \u001b[43mst\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43maltair_chart\u001b[49m\u001b[43m(\u001b[49m\u001b[43mchart\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43muse_container_width\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m)\u001b[49m\n\u001b[1;32m     92\u001b[0m \u001b[38;5;66;03m# Histograma de Riesgo\u001b[39;00m\n\u001b[1;32m     93\u001b[0m st\u001b[38;5;241m.\u001b[39msubheader(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mDistribución de Probabilidad Final\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/streamlit/runtime/metrics_util.py:447\u001b[0m, in \u001b[0;36mgather_metrics.<locals>.wrapped_func\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m    445\u001b[0m         _LOGGER\u001b[38;5;241m.\u001b[39mdebug(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mFailed to collect command telemetry\u001b[39m\u001b[38;5;124m\"\u001b[39m, exc_info\u001b[38;5;241m=\u001b[39mex)\n\u001b[1;32m    446\u001b[0m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[0;32m--> 447\u001b[0m     result \u001b[38;5;241m=\u001b[39m \u001b[43mnon_optional_func\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    448\u001b[0m \u001b[38;5;28;01mexcept\u001b[39;00m RerunException:\n\u001b[1;32m    449\u001b[0m     \u001b[38;5;66;03m# Duplicated from below, because static analysis tools get confused\u001b[39;00m\n\u001b[1;32m    450\u001b[0m     \u001b[38;5;66;03m# by deferring the rethrow.\u001b[39;00m\n\u001b[1;32m    451\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m tracking_activated \u001b[38;5;129;01mand\u001b[39;00m command_telemetry:\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py:1903\u001b[0m, in \u001b[0;36mVegaChartsMixin.altair_chart\u001b[0;34m(self, altair_chart, width, height, use_container_width, theme, key, on_select, selection_mode)\u001b[0m\n\u001b[1;32m   1735\u001b[0m \u001b[38;5;129m@gather_metrics\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124maltair_chart\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m   1736\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21maltair_chart\u001b[39m(\n\u001b[1;32m   1737\u001b[0m     \u001b[38;5;28mself\u001b[39m,\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m   1746\u001b[0m     selection_mode: \u001b[38;5;28mstr\u001b[39m \u001b[38;5;241m|\u001b[39m Iterable[\u001b[38;5;28mstr\u001b[39m] \u001b[38;5;241m|\u001b[39m \u001b[38;5;28;01mNone\u001b[39;00m \u001b[38;5;241m=\u001b[39m \u001b[38;5;28;01mNone\u001b[39;00m,\n\u001b[1;32m   1747\u001b[0m ) \u001b[38;5;241m-\u001b[39m\u001b[38;5;241m>\u001b[39m DeltaGenerator \u001b[38;5;241m|\u001b[39m VegaLiteState:\n\u001b[1;32m   1748\u001b[0m \u001b[38;5;250m    \u001b[39m\u001b[38;5;124;03m\"\"\"Display a chart using the Vega-Altair library.\u001b[39;00m\n\u001b[1;32m   1749\u001b[0m \n\u001b[1;32m   1750\u001b[0m \u001b[38;5;124;03m    `Vega-Altair <https://altair-viz.github.io/>`_ is a declarative\u001b[39;00m\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m   1901\u001b[0m \n\u001b[1;32m   1902\u001b[0m \u001b[38;5;124;03m    \"\"\"\u001b[39;00m\n\u001b[0;32m-> 1903\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_altair_chart\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m   1904\u001b[0m \u001b[43m        \u001b[49m\u001b[43maltair_chart\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43maltair_chart\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1905\u001b[0m \u001b[43m        \u001b[49m\u001b[43mwidth\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mwidth\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1906\u001b[0m \u001b[43m        \u001b[49m\u001b[43mheight\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mheight\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1907\u001b[0m \u001b[43m        \u001b[49m\u001b[43muse_container_width\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43muse_container_width\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1908\u001b[0m \u001b[43m        \u001b[49m\u001b[43mtheme\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mtheme\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1909\u001b[0m \u001b[43m        \u001b[49m\u001b[43mkey\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mkey\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1910\u001b[0m \u001b[43m        \u001b[49m\u001b[43mon_select\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mon_select\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1911\u001b[0m \u001b[43m        \u001b[49m\u001b[43mselection_mode\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[43mselection_mode\u001b[49m\u001b[43m,\u001b[49m\n\u001b[1;32m   1912\u001b[0m \u001b[43m    \u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py:2171\u001b[0m, in \u001b[0;36mVegaChartsMixin._altair_chart\u001b[0;34m(self, altair_chart, use_container_width, theme, key, on_select, selection_mode, add_rows_metadata, width, height)\u001b[0m\n\u001b[1;32m   2163\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m type_util\u001b[38;5;241m.\u001b[39mis_altair_version_less_than(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m5.0.0\u001b[39m\u001b[38;5;124m\"\u001b[39m) \u001b[38;5;129;01mand\u001b[39;00m on_select \u001b[38;5;241m!=\u001b[39m \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mignore\u001b[39m\u001b[38;5;124m\"\u001b[39m:\n\u001b[1;32m   2164\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m StreamlitAPIException(\n\u001b[1;32m   2165\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mStreamlit does not support selections with Altair 4.x. Please upgrade \u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m   2166\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mto Version 5. \u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m   2167\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mIf you would like to use Altair 4.x with selections, please upvote \u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m   2168\u001b[0m         \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mthis [Github issue](https://github.com/streamlit/streamlit/issues/8516).\u001b[39m\u001b[38;5;124m\"\u001b[39m\n\u001b[1;32m   2169\u001b[0m     )\n\u001b[0;32m-> 2171\u001b[0m vega_lite_spec \u001b[38;5;241m=\u001b[39m \u001b[43m_convert_altair_to_vega_lite_spec\u001b[49m\u001b[43m(\u001b[49m\u001b[43maltair_chart\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   2172\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39m_vega_lite_chart(\n\u001b[1;32m   2173\u001b[0m     data\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mNone\u001b[39;00m,  \u001b[38;5;66;03m# The data is already part of the spec\u001b[39;00m\n\u001b[1;32m   2174\u001b[0m     spec\u001b[38;5;241m=\u001b[39mvega_lite_spec,\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m   2182\u001b[0m     height\u001b[38;5;241m=\u001b[39mheight,\n\u001b[1;32m   2183\u001b[0m )\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py:419\u001b[0m, in \u001b[0;36m_convert_altair_to_vega_lite_spec\u001b[0;34m(altair_chart)\u001b[0m\n\u001b[1;32m    416\u001b[0m     \u001b[38;5;28;01mwith\u001b[39;00m theme_context:  \u001b[38;5;66;03m# ty: ignore[invalid-context-manager]\u001b[39;00m\n\u001b[1;32m    417\u001b[0m         \u001b[38;5;66;03m# type: ignore[attr-defined,unused-ignore]\u001b[39;00m\n\u001b[1;32m    418\u001b[0m         \u001b[38;5;28;01mwith\u001b[39;00m data_transformer:  \u001b[38;5;66;03m# ty: ignore[invalid-context-manager]\u001b[39;00m\n\u001b[0;32m--> 419\u001b[0m             chart_dict \u001b[38;5;241m=\u001b[39m \u001b[43maltair_chart\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mto_dict\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    421\u001b[0m \u001b[38;5;66;03m# Put datasets back into the chart dict:\u001b[39;00m\n\u001b[1;32m    422\u001b[0m chart_dict[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdatasets\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;241m=\u001b[39m datasets\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/altair/vegalite/v5/api.py:4033\u001b[0m, in \u001b[0;36mChart.to_dict\u001b[0;34m(self, validate, format, ignore, context)\u001b[0m\n\u001b[1;32m   4031\u001b[0m     copy\u001b[38;5;241m.\u001b[39mdata \u001b[38;5;241m=\u001b[39m core\u001b[38;5;241m.\u001b[39mInlineData(values\u001b[38;5;241m=\u001b[39m[{}])\n\u001b[1;32m   4032\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28msuper\u001b[39m(Chart, copy)\u001b[38;5;241m.\u001b[39mto_dict(\u001b[38;5;241m*\u001b[39m\u001b[38;5;241m*\u001b[39mkwds)\n\u001b[0;32m-> 4033\u001b[0m \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43msuper\u001b[39;49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mto_dict\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwds\u001b[49m\u001b[43m)\u001b[49m\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/altair/vegalite/v5/api.py:1998\u001b[0m, in \u001b[0;36mTopLevelMixin.to_dict\u001b[0;34m(self, validate, format, ignore, context)\u001b[0m\n\u001b[1;32m   1995\u001b[0m     \u001b[38;5;28;01mexcept\u001b[39;00m \u001b[38;5;167;01mTypeError\u001b[39;00m:\n\u001b[1;32m   1996\u001b[0m         \u001b[38;5;66;03m# Non-narwhalifiable type supported by Altair, such as dict\u001b[39;00m\n\u001b[1;32m   1997\u001b[0m         data \u001b[38;5;241m=\u001b[39m original_data\n\u001b[0;32m-> 1998\u001b[0m     copy\u001b[38;5;241m.\u001b[39mdata \u001b[38;5;241m=\u001b[39m \u001b[43m_prepare_data\u001b[49m\u001b[43m(\u001b[49m\u001b[43mdata\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mcontext\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   1999\u001b[0m     context[\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mdata\u001b[39m\u001b[38;5;124m\"\u001b[39m] \u001b[38;5;241m=\u001b[39m data\n\u001b[1;32m   2001\u001b[0m \u001b[38;5;66;03m# remaining to_dict calls are not at top level\u001b[39;00m\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/altair/vegalite/v5/api.py:283\u001b[0m, in \u001b[0;36m_prepare_data\u001b[0;34m(data, context)\u001b[0m\n\u001b[1;32m    281\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(data, \u001b[38;5;28mdict\u001b[39m) \u001b[38;5;129;01mand\u001b[39;00m _is_data_type(data):\n\u001b[1;32m    282\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m func \u001b[38;5;241m:=\u001b[39m data_transformers\u001b[38;5;241m.\u001b[39mget():\n\u001b[0;32m--> 283\u001b[0m         data \u001b[38;5;241m=\u001b[39m \u001b[43mfunc\u001b[49m\u001b[43m(\u001b[49m\u001b[43mnw\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mto_native\u001b[49m\u001b[43m(\u001b[49m\u001b[43mdata\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mpass_through\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43;01mTrue\u001b[39;49;00m\u001b[43m)\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m    285\u001b[0m \u001b[38;5;66;03m# convert string input to a URLData\u001b[39;00m\n\u001b[1;32m    286\u001b[0m \u001b[38;5;28;01melif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(data, \u001b[38;5;28mstr\u001b[39m):\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/streamlit/elements/vega_charts.py:2375\u001b[0m, in \u001b[0;36m_to_arrow_dataset\u001b[0;34m(data, datasets)\u001b[0m\n\u001b[1;32m   2368\u001b[0m \u001b[38;5;250m\u001b[39m\u001b[38;5;124;03m\"\"\"Altair data transformer that serializes the data,\u001b[39;00m\n\u001b[1;32m   2369\u001b[0m \u001b[38;5;124;03mcreates a stable name based on the hash of the data,\u001b[39;00m\n\u001b[1;32m   2370\u001b[0m \u001b[38;5;124;03mstores the bytes into the datasets mapping and\u001b[39;00m\n\u001b[1;32m   2371\u001b[0m \u001b[38;5;124;03mreturns this name to have it be used in Altair.\u001b[39;00m\n\u001b[1;32m   2372\u001b[0m \u001b[38;5;124;03m\"\"\"\u001b[39;00m\n\u001b[1;32m   2373\u001b[0m \u001b[38;5;66;03m# Already serialize the data to be able to create a stable\u001b[39;00m\n\u001b[1;32m   2374\u001b[0m \u001b[38;5;66;03m# dataset name:\u001b[39;00m\n\u001b[0;32m-> 2375\u001b[0m data_bytes \u001b[38;5;241m=\u001b[39m \u001b[43mdataframe_util\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mconvert_anything_to_arrow_bytes\u001b[49m\u001b[43m(\u001b[49m\u001b[43mdata\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m   2376\u001b[0m \u001b[38;5;66;03m# Use the md5 hash of the data as the name:\u001b[39;00m\n\u001b[1;32m   2377\u001b[0m name \u001b[38;5;241m=\u001b[39m calc_md5(\u001b[38;5;28mstr\u001b[39m(data_bytes))\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/streamlit/dataframe_util.py:899\u001b[0m, in \u001b[0;36mconvert_anything_to_arrow_bytes\u001b[0;34m(data, max_unevaluated_rows)\u001b[0m\n\u001b[1;32m    874\u001b[0m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21mconvert_anything_to_arrow_bytes\u001b[39m(\n\u001b[1;32m    875\u001b[0m     data: Any,\n\u001b[1;32m    876\u001b[0m     max_unevaluated_rows: \u001b[38;5;28mint\u001b[39m \u001b[38;5;241m=\u001b[39m _MAX_UNEVALUATED_DF_ROWS,\n\u001b[1;32m    877\u001b[0m ) \u001b[38;5;241m-\u001b[39m\u001b[38;5;241m>\u001b[39m \u001b[38;5;28mbytes\u001b[39m:\n\u001b[1;32m    878\u001b[0m \u001b[38;5;250m    \u001b[39m\u001b[38;5;124;03m\"\"\"Try to convert different formats to Arrow IPC format (bytes).\u001b[39;00m\n\u001b[1;32m    879\u001b[0m \n\u001b[1;32m    880\u001b[0m \u001b[38;5;124;03m    This method tries to directly convert the input data to Arrow bytes\u001b[39;00m\n\u001b[0;32m   (...)\u001b[0m\n\u001b[1;32m    896\u001b[0m \u001b[38;5;124;03m        The serialized Arrow IPC bytes.\u001b[39;00m\n\u001b[1;32m    897\u001b[0m \u001b[38;5;124;03m    \"\"\"\u001b[39;00m\n\u001b[0;32m--> 899\u001b[0m     \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mpyarrow\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mpa\u001b[39;00m\n\u001b[1;32m    901\u001b[0m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28misinstance\u001b[39m(data, pa\u001b[38;5;241m.\u001b[39mTable):\n\u001b[1;32m    902\u001b[0m         \u001b[38;5;28;01mreturn\u001b[39;00m convert_arrow_table_to_arrow_bytes(data)\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/pyarrow/__init__.py:65\u001b[0m\n\u001b[1;32m     63\u001b[0m _gc_enabled \u001b[38;5;241m=\u001b[39m _gc\u001b[38;5;241m.\u001b[39misenabled()\n\u001b[1;32m     64\u001b[0m _gc\u001b[38;5;241m.\u001b[39mdisable()\n\u001b[0;32m---> 65\u001b[0m \u001b[38;5;28;01mimport\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01mpyarrow\u001b[39;00m\u001b[38;5;21;01m.\u001b[39;00m\u001b[38;5;21;01mlib\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;28;01mas\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[38;5;21;01m_lib\u001b[39;00m\n\u001b[1;32m     66\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m _gc_enabled:\n\u001b[1;32m     67\u001b[0m     _gc\u001b[38;5;241m.\u001b[39menable()\n",
      "File \u001b[0;32m~/anaconda3/lib/python3.11/site-packages/pyarrow/lib.pyx:37\u001b[0m, in \u001b[0;36minit pyarrow.lib\u001b[0;34m()\u001b[0m\n",
      "\u001b[0;31mImportError\u001b[0m: numpy.core.multiarray failed to import"
     ]
    }
   ],
   "source": [
    "import streamlit as st\n",
    "import yfinance as yf\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import altair as alt\n",
    "\n",
    "# Configuración visual estilo \"Stock Peers\"\n",
    "st.set_page_config(\n",
    "    page_title=\"Monte Carlo Portfolio Risk\",\n",
    "    page_icon=\":chart_with_upwards_trend:\",\n",
    "    layout=\"wide\",\n",
    ")\n",
    "\n",
    "st.title(\":material/analytics: Monte Carlo Portfolio Risk Engine\")\n",
    "st.markdown(\"Simulación estocástica multivariada con **Descomposición de Cholesky**.\")\n",
    "\n",
    "# --- SIDEBAR: CONFIGURACIÓN ---\n",
    "with st.sidebar:\n",
    "    st.header(\"Configuración\")\n",
    "    tickers = st.multiselect(\n",
    "        \"Activos del Portafolio\",\n",
    "        [\"AAPL\", \"MSFT\", \"NVDA\", \"BTC-USD\", \"ETH-USD\", \"AMZN\", \"GOOGL\"],\n",
    "        default=[\"AAPL\", \"NVDA\", \"BTC-USD\"]\n",
    "    )\n",
    "    \n",
    "    dias = st.slider(\"Días a proyectar\", 30, 365, 252)\n",
    "    n_sims = st.number_input(\"Número de simulaciones\", 100, 5000, 1000, step=100)\n",
    "    confianza = st.select_slider(\"Nivel de Confianza VaR\", options=[0.90, 0.95, 0.99], value=0.95)\n",
    "\n",
    "if not tickers:\n",
    "    st.warning(\"Selecciona al menos un activo para comenzar.\")\n",
    "    st.stop()\n",
    "\n",
    "# --- LÓGICA CORE (Basada en simulation.ipynb) ---\n",
    "@st.cache_data\n",
    "def get_data(tickers):\n",
    "    df = yf.download(tickers, period=\"1y\")['Close']\n",
    "    return df.dropna()\n",
    "\n",
    "data = get_data(tickers)\n",
    "log_returns = np.log(data / data.shift(1)).dropna()\n",
    "\n",
    "# Parámetros estadísticos\n",
    "mu = log_returns.mean().values\n",
    "sigma = log_returns.cov().values\n",
    "S0 = data.iloc[-1].values\n",
    "w = np.array([1/len(tickers)] * len(tickers)) # Equal weight por defecto\n",
    "\n",
    "# Aplicamos Cholesky para correlación real\n",
    "try:\n",
    "    L = np.linalg.cholesky(sigma)\n",
    "except np.linalg.LinAlgError:\n",
    "    # Ajuste por si la matriz no es definida positiva (común en crypto/altas corr)\n",
    "    sigma_adj = sigma + np.eye(len(tickers)) * 1e-8\n",
    "    L = np.linalg.cholesky(sigma_adj)\n",
    "\n",
    "# Simulación Vectorizada\n",
    "Z = np.random.normal(0, 1, (dias, len(tickers), n_sims))\n",
    "portafolio_paths = np.zeros((dias, n_sims))\n",
    "valor_inicial = np.sum(S0 * w)\n",
    "\n",
    "for s in range(n_sims):\n",
    "    # Correlacionamos los ruidos aleatorios\n",
    "    Z_corr = Z[:, :, s] @ L.T\n",
    "    # Drift + Volatilidad (GBM)\n",
    "    returns_path = np.exp((mu - 0.5 * np.diag(sigma)) + Z_corr)\n",
    "    price_paths = S0 * np.cumprod(returns_path, axis=0)\n",
    "    portafolio_paths[:, s] = price_paths @ w\n",
    "\n",
    "# --- INTERFAZ DE RESULTADOS ---\n",
    "precios_finales = portafolio_paths[-1, :]\n",
    "var_valor = np.percentile(precios_finales, (1 - confianza) * 100)\n",
    "rendimiento_medio = (np.mean(precios_finales) / valor_inicial - 1) * 100\n",
    "\n",
    "# Métricas estilo \"Peer Analysis\"\n",
    "c1, c2, c3 = st.columns(3)\n",
    "c1.metric(\"Valor Inicial\", f\"${valor_inicial:,.2f}\")\n",
    "c2.metric(\"Value at Risk (VaR)\", f\"${var_valor:,.2f}\", f\"{((var_valor/valor_inicial)-1)*100:.2f}%\", delta_color=\"inverse\")\n",
    "c3.metric(\"Rendimiento Esperado\", f\"{rendimiento_medio:.2f}%\")\n",
    "\n",
    "# Gráfico de Trayectorias (Altair - Estilo Moderno)\n",
    "st.subheader(\"Proyección de Escenarios (Muestra de 100 rutas)\")\n",
    "df_paths = pd.DataFrame(portafolio_paths[:, :100]).reset_index().melt('index', var_name='Simulación', value_name='Precio')\n",
    "chart = alt.Chart(df_paths).mark_line(opacity=0.3, strokeWidth=1).encode(\n",
    "    x=alt.X('index:Q', title=\"Días\"),\n",
    "    y=alt.Y('Precio:Q', title=\"Valor Portafolio ($)\", scale=alt.Scale(zero=False)),\n",
    "    detail='Simulación'\n",
    ").properties(height=400)\n",
    "\n",
    "st.altair_chart(chart, use_container_width=True)\n",
    "\n",
    "# Histograma de Riesgo\n",
    "st.subheader(\"Distribución de Probabilidad Final\")\n",
    "hist_data = pd.DataFrame({'Precios Finales': precios_finales})\n",
    "hist_chart = alt.Chart(hist_data).mark_bar(color=\"#615fff\").encode(\n",
    "    alt.X(\"Precios Finales:Q\", bin=alt.Bin(maxbins=50), title=\"Precio Final al horizonte\"),\n",
    "    alt.Y('count()', title=\"Frecuencia\")\n",
    ").properties(height=300)\n",
    "\n",
    "st.altair_chart(hist_chart, use_container_width=True)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:base] *",
   "language": "python",
   "name": "conda-base-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
